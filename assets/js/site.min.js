!function(){"use strict";function e(e,n,r,o,a){function i(t){if(u)return a(new Error("Scroll cancelled"),n[e]);var o=+new Date,f=Math.min(1,(o-l)/d),m=s(f);n[e]=m*(r-c)+c,v(f<1?i:function(){a(null,n[e])})}var l=+new Date,c=n[e],u=!1,s=t,d=350;return"function"==typeof o?a=o:(s=(o=o||{}).ease||s,d=o.duration||d,a=a||function(){}),c===r?a(new Error("Element already at target scroll position"),n[e]):(v(i),function(){u=!0})}function t(e){return.5*(1-Math.cos(Math.PI*e))}var n=function(e){var t=new XMLHttpRequest,n=function(){};return t.open("GET",e,!0),{then:function(e){return t.onload=function(){(this.status<200||this.status>=400)&&n&&n(this),e(this.response)},t.onerror=n,t.send(),{catch:function(e){n=e}}}}};n("/assets/icons/sprite.svg").then(function(e){var t=document.createElement("figure");t.style.display="none",t.innerHTML=e,document.body.insertBefore(t,document.body.children[0])}).catch(function(e){console.warn("Icon spritesheet could not be loaded\n",e)});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){var e=function(e){return"function"==typeof e},t=Math.pow(2,53)-1,n=function(e){var n=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(n,0),t)},o=function(e){var t=e.next();return!Boolean(t.done)&&t};return function(t){var a,i=arguments.length>1?arguments[1]:void 0;if(void 0!==i){if(!e(i))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(a=arguments[2])}var l,c,u=function(t,n){if(null!=t&&null!=n){var r=t[n];if(null==r)return;if(!e(r))throw new TypeError(r+" is not a function");return r}}(t,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(void 0===e?"undefined":r(e))>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(t));if(void 0!==u){l=e(this)?Object(new this):[];var s=u.call(t);if(null==s)throw new TypeError("Array.from requires an array-like or iterable object");c=0;for(var d,f;;){if(!(d=o(s)))return l.length=c,l;f=d.value,l[c]=i?i.call(a,f,c):f,c++}}else{var m=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var p=n(m.length);l=e(this)?Object(new this(p)):new Array(p),c=0;for(var v;c<p;)v=m[c],l[c]=i?i.call(a,v,c):v,c++;l.length=p}return l}}(),i="function"==typeof Array.from?Array.from:a,l=document.scrollingElement||document.documentElement,c={scrollBox:l,find:function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)},findAll:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return i(t.querySelectorAll(e))},get scrollTop(){return l.scrollTop}},u=c.find("[data-timer]"),s=0,d=c.findAll("[data-slide]").map(function(e,t){return t?e.classList.remove("active-slide"):e.classList.add("active-slide"),e}),f=function(){d[s].classList.remove("active-slide"),s=s+1===d.length?0:s+1,d[s].classList.add("active-slide"),u.classList.add("running")};u.addEventListener("transitionend",function(){u.classList.remove("running"),setTimeout(f,125)}),setTimeout(function(){u.classList.add("running")},250);var m="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},p="undefined"!=typeof window?window:void 0!==m?m:"undefined"!=typeof self?self:{},v=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e,t){var n=p.requestAnimationFrame||p.webkitRequestAnimationFrame||p.mozRequestAnimationFrame||function(e){var t=+new Date,n=Math.max(0,16-(t-r)),o=setTimeout(e,n);return r=t,o},r=+new Date,o=p.cancelAnimationFrame||p.webkitCancelAnimationFrame||p.mozCancelAnimationFrame||clearTimeout;Function.prototype.bind&&(n=n.bind(p),o=o.bind(p)),(e.exports=n).cancel=o}),h=function(t,n,r,o){return e("scrollTop",t,n,r,o)},y=function(e){return c.scrollTop+c.find(e).getBoundingClientRect().top-c.find("[data-header]").clientHeight},b=function(e){e.preventDefault(),h(c.scrollBox,y(this.getAttribute("href")),{duration:500})};c.findAll("[data-scroll-to]").forEach(function(e){e.addEventListener("click",b)});var g=c.find("[data-header]"),w=void 0,E=void 0,A=void 0,L=function(){(w>10&&!A||w<=10&&A)&&(A=g.classList.toggle("header--docked")),E=!1},T=function(){E||requestAnimationFrame(L),E=!0,w=c.scrollTop};T(),window.addEventListener("scroll",T);c.findAll("[data-card]").forEach(function(e){(function(e){var t=o(e,2),n=t[0],r=t[1];return n.clientHeight<r.clientHeight?n:r})(e.children).style.position="absolute",c.findAll("[data-card-flip]",e).forEach(function(t){t.addEventListener("click",function(e){return function(){return e.classList.add("card--flip")}}(e))}),c.findAll("[data-card-unflip]",e).forEach(function(t){t.addEventListener("click",function(e){return function(){return e.classList.remove("card--flip")}}(e))})});var M=document.getElementById("map");M&&n("/assets/data/map-config.json").then(function(e){var t=JSON.parse(e),n=t.key,r=t.options,o=t.marker,a=function(){return new google.maps.Map(M,r)},i=function(e){return new google.maps.Marker({position:o,map:e,icon:"/assets/media/logo/llb-map.png"})};window.initMap=function(){i(a())},document.body.appendChild(function(e){var t=document.createElement("script");return t.setAttribute("async",""),t.setAttribute("defer",""),t.setAttribute("src","https://maps.googleapis.com/maps/api/js?key="+e+"&callback=initMap"),t}(n))}).catch(function(e){return console.log(e)});var S=new Date;c.findAll("time[data-year]").forEach(function(e){e.innerHTML+=S.getFullYear()});var k=c.find("[data-header]");c.find("[data-burger]",k).addEventListener("click",function(){k.classList.toggle("header--open"),document.body.classList.toggle("noscroll")}),c.findAll("[data-scroll-to]").forEach(function(e){e.addEventListener("click",function(){k.classList.remove("header--open"),document.body.classList.remove("noscroll")})}),function(e){e&&(c.findAll("input, textarea",e).forEach(function(e){e.addEventListener("focus",function(){e.dataset.state="ok"})}),e.addEventListener("submit",function(t){t.preventDefault();var n=new XMLHttpRequest,r=new FormData,o=!0,a=!1,i=c.find("[data-attachment]",e),l={name:c.find('[name="name"]',e),surname:c.find('[name="surname"]',e),email:c.find('[name="email"]',e),message:c.find('[name="message"]',e)};Object.values(l).forEach(function(e){e.value&&e.value.length?"email"!==e.name||/.+@.+\..+/.test(e.value)||(e.dataset.state="error",o=!1):(e.dataset.state="error",o=!1)}),!a&&o&&(a=!0,n.open("POST","http://udy.io/api/mail/",!0),e.dataset.state="sending",r.append("sitename","llb-cpa"),r.append("email",l.email.value),r.append("mailto","reception@llbcpa.ca"),r.append("message",l.message.value),r.append("subject","Nouveau contact"),r.append("name",l.name.value+" "+l.surname.value),i&&r.append("attachment",i.files[0]),n.addEventListener("load",function(){this.status>=200&&this.status<400?e.dataset.state="success":e.dataset.state="error"}),n.send(r))}))}(c.find("[data-contact-form]"))}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9zY3JvbGwvaW5kZXguanMiLCJzY3JpcHRzL21vZHVsZXMvZmV0Y2guanMiLCJzY3JpcHRzL21vZHVsZXMvaWNvbi1zcHJpdGUuanMiLCJub2RlX21vZHVsZXMvYXJyYXktZnJvbS9wb2x5ZmlsbC5qcyIsIm5vZGVfbW9kdWxlcy9hcnJheS1mcm9tL2luZGV4LmpzIiwic2NyaXB0cy9tb2R1bGVzL2RvbS1oZWxwZXJzLmpzIiwic2NyaXB0cy9tb2R1bGVzL3NsaWRlci5qcyIsIm5vZGVfbW9kdWxlcy9nbG9iYWwvd2luZG93LmpzIiwibm9kZV9tb2R1bGVzL3JhZmwvaW5kZXguanMiLCJzY3JpcHRzL21vZHVsZXMvc2Nyb2xsLXRvLmpzIiwic2NyaXB0cy9tb2R1bGVzL2RvY2staGVhZGVyLmpzIiwic2NyaXB0cy9tb2R1bGVzL2NhcmQtZmxpcC5qcyIsInNjcmlwdHMvbW9kdWxlcy9nb29nbGUtbWFwLmpzIiwic2NyaXB0cy9tb2R1bGVzL2RhdGV0aW1lLW91dHB1dC5qcyIsInNjcmlwdHMvbW9kdWxlcy9tb2JpbGUtbWVudS5qcyIsInNjcmlwdHMvbW9kdWxlcy9jb250YWN0LWZvcm0uanMiXSwibmFtZXMiOlsic2Nyb2xsIiwicHJvcCIsImVsZW1lbnQiLCJ0byIsIm9wdGlvbnMiLCJjYWxsYmFjayIsImFuaW1hdGUiLCJ0aW1lc3RhbXAiLCJjYW5jZWxsZWQiLCJFcnJvciIsIm5vdyIsIkRhdGUiLCJ0aW1lIiwiTWF0aCIsIm1pbiIsInN0YXJ0IiwiZHVyYXRpb24iLCJlYXNlZCIsImVhc2UiLCJmcm9tIiwicmFmIiwiaW5PdXRTaW5lIiwibiIsImNvcyIsIlBJIiwiZmV0Y2giLCJ1cmkiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsImVycm9ySGFuZGxlciIsIm9wZW4iLCJjYiIsIm9ubG9hZCIsInRoaXMiLCJzdGF0dXMiLCJyZXNwb25zZSIsIm9uZXJyb3IiLCJzZW5kIiwiaGFuZGxlciIsInRoZW4iLCJzcHJpdGUiLCJmaWd1cmUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImRpc3BsYXkiLCJpbm5lckhUTUwiLCJib2R5IiwiaW5zZXJ0QmVmb3JlIiwiY2hpbGRyZW4iLCJjYXRjaCIsImVyciIsIndhcm4iLCJwb2x5ZmlsbCIsImlzQ2FsbGFibGUiLCJmbiIsIm1heFNhZmVJbnRlZ2VyIiwicG93IiwidG9MZW5ndGgiLCJ2YWx1ZSIsImxlbiIsIm51bWJlciIsIk51bWJlciIsImlzTmFOIiwiaXNGaW5pdGUiLCJmbG9vciIsImFicyIsInRvSW50ZWdlciIsIm1heCIsIml0ZXJhdG9yU3RlcCIsIml0ZXJhdG9yIiwicmVzdWx0IiwibmV4dCIsIkJvb2xlYW4iLCJkb25lIiwiaXRlbXMiLCJUIiwibWFwRm4iLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJUeXBlRXJyb3IiLCJBIiwiayIsInVzaW5nSXRlcmF0b3IiLCJPIiwiUCIsImZ1bmMiLCJnZXRNZXRob2QiLCJpbmRleE9mIiwiX3R5cGVvZiIsIlN5bWJvbCIsIml0ZXJhdG9yUHJvcCIsIk9iamVjdCIsImNhbGwiLCJuZXh0VmFsdWUiLCJhcnJheUxpa2UiLCJBcnJheSIsImtWYWx1ZSIsImFycmF5RnJvbSIsInJlcXVpcmUkJDAiLCJzY3JvbGxCb3giLCJzY3JvbGxpbmdFbGVtZW50IiwiZG9jdW1lbnRFbGVtZW50IiwiZG9tIiwicXVlcnkiLCJ1bmRlZmluZWQiLCJxdWVyeVNlbGVjdG9yIiwic2NvcGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwic2Nyb2xsVG9wIiwidGltZXIiLCJmaW5kIiwiaW5kZXgiLCJzbGlkZXMiLCJmaW5kQWxsIiwibWFwIiwibm9kZSIsImkiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJzd2FwU2xpZGVzIiwiYWRkRXZlbnRMaXN0ZW5lciIsInNldFRpbWVvdXQiLCJ3aW5kb3dfMSIsIndpbmRvdyIsImdsb2JhbCIsInNlbGYiLCJyZXF1ZXN0IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwid2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY3VyciIsIm1zIiwicHJldiIsInJlcSIsImNhbmNlbCIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwid2Via2l0Q2FuY2VsQW5pbWF0aW9uRnJhbWUiLCJtb3pDYW5jZWxBbmltYXRpb25GcmFtZSIsImNsZWFyVGltZW91dCIsIkZ1bmN0aW9uIiwicHJvdG90eXBlIiwiYmluZCIsIm1vZHVsZSIsInNjcm9sbF8xIiwicmVzb2x2ZVRhcmdldCIsImlkIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwiY2xpZW50SGVpZ2h0Iiwic2Nyb2xsSGFuZGxlciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImdldEF0dHJpYnV0ZSIsImZvckVhY2giLCJoZWFkZXIiLCJidWZmZXIiLCJkb2NrZWQiLCJ1cGRhdGUiLCJ0b2dnbGUiLCJyZXF1ZXN0VXBkYXRlIiwiX3JlZiIsImZyb250IiwiX3JlZjIiLCJiYWNrIiwicG9zaXRpb24iLCJmbGlwTm9kZSIsImdldEZsaXBIYW5kbGVyIiwidW5mbGlwTm9kZSIsImdldFVuZmxpcEhhbmRsZXIiLCJtYXBOb2RlIiwiZ2V0RWxlbWVudEJ5SWQiLCJjb25maWciLCJKU09OIiwicGFyc2UiLCJrZXkiLCJfSlNPTiRwYXJzZSIsIm1hcmtlciIsImluaXQiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiTWFya2VyIiwiaW5pdE1hcCIsImFwcGVuZENoaWxkIiwidGFnIiwic2V0QXR0cmlidXRlIiwiZ2V0U2NyaXB0VGFnIiwiY29uc29sZSIsImxvZyIsImRhdGUiLCJnZXRGdWxsWWVhciIsImZvcm0iLCJpbnB1dCIsImRhdGFzZXQiLCJzdGF0ZSIsImh0dHAiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwidmFsaWQiLCJzdWJtaXR0ZWQiLCJmaWxlSW5wdXQiLCJmaWVsZHMiLCJ2YWx1ZXMiLCJmaWVsZCIsIm5hbWUiLCJ0ZXN0IiwiYXBwZW5kIiwiZW1haWwiLCJtZXNzYWdlIiwic3VybmFtZSIsImZpbGVzIl0s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LFdBQ3JEd0ksUUFBUUMsTUFBUSxXQUNkLE1BSkZELFFBQVFDLE1BQVEsV0FDZCxNQU9WSyxHQUFjRCxPQUNOLElBRVAxSyxLQUFLLE9BQVEsMkJBQTJCLEtBRXhDcUssUUFBUUMsTUFBUSxZQUNaWSxPQUFPLFdBQVksYUFDbkJBLE9BQU8sUUFBU0wsRUFBT00sTUFBTXRKLFNBQzdCcUosT0FBTyxTQUFVLHlCQUNqQkEsT0FBTyxVQUFXTCxFQUFPTyxRQUFRdkosU0FDakNxSixPQUFPLFVBQVcscUJBQ2xCQSxPQUFPLE9BQVdMLEVBQU9HLEtBQUtuSixNQUF2QyxJQUFnRGdKLEVBQU9RLFFBQVF4SixPQUUzRCtJLEdBQVdKLEVBQVNVLE9BQU8sYUFBY04sRUFBVVUsTUFBTSxNQUV4RDFGLGlCQUFpQixPQUFRLFdBQ3hCekYsS0FBS0MsUUFBVSxLQUFPRCxLQUFLQyxPQUFTLE1BQ2pDaUssUUFBUUMsTUFBUSxZQUVoQkQsUUFBUUMsTUFBUSxZQUlwQi9KLEtBQUtpSyxPQTdEUixDQStESC9GLEVBQUlRLEtBQUsiLCJmaWxlIjoic2l0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciByYWYgPSByZXF1aXJlKCdyYWZsJylcblxuZnVuY3Rpb24gc2Nyb2xsIChwcm9wLCBlbGVtZW50LCB0bywgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgdmFyIHN0YXJ0ID0gK25ldyBEYXRlXG4gIHZhciBmcm9tID0gZWxlbWVudFtwcm9wXVxuICB2YXIgY2FuY2VsbGVkID0gZmFsc2VcblxuICB2YXIgZWFzZSA9IGluT3V0U2luZVxuICB2YXIgZHVyYXRpb24gPSAzNTBcblxuICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnNcbiAgfVxuICBlbHNlIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fVxuICAgIGVhc2UgPSBvcHRpb25zLmVhc2UgfHwgZWFzZVxuICAgIGR1cmF0aW9uID0gb3B0aW9ucy5kdXJhdGlvbiB8fCBkdXJhdGlvblxuICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24gKCkge31cbiAgfVxuXG4gIGlmIChmcm9tID09PSB0bykge1xuICAgIHJldHVybiBjYWxsYmFjayhcbiAgICAgIG5ldyBFcnJvcignRWxlbWVudCBhbHJlYWR5IGF0IHRhcmdldCBzY3JvbGwgcG9zaXRpb24nKSxcbiAgICAgIGVsZW1lbnRbcHJvcF1cbiAgICApXG4gIH1cblxuICBmdW5jdGlvbiBjYW5jZWwgKCkge1xuICAgIGNhbmNlbGxlZCA9IHRydWVcbiAgfVxuXG4gIGZ1bmN0aW9uIGFuaW1hdGUgKHRpbWVzdGFtcCkge1xuICAgIGlmIChjYW5jZWxsZWQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhcbiAgICAgICAgbmV3IEVycm9yKCdTY3JvbGwgY2FuY2VsbGVkJyksXG4gICAgICAgIGVsZW1lbnRbcHJvcF1cbiAgICAgIClcbiAgICB9XG5cbiAgICB2YXIgbm93ID0gK25ldyBEYXRlXG4gICAgdmFyIHRpbWUgPSBNYXRoLm1pbigxLCAoKG5vdyAtIHN0YXJ0KSAvIGR1cmF0aW9uKSlcbiAgICB2YXIgZWFzZWQgPSBlYXNlKHRpbWUpXG5cbiAgICBlbGVtZW50W3Byb3BdID0gKGVhc2VkICogKHRvIC0gZnJvbSkpICsgZnJvbVxuXG4gICAgdGltZSA8IDEgPyByYWYoYW5pbWF0ZSkgOiByYWYoZnVuY3Rpb24gKCkge1xuICAgICAgY2FsbGJhY2sobnVsbCwgZWxlbWVudFtwcm9wXSlcbiAgICB9KVxuICB9XG5cbiAgcmFmKGFuaW1hdGUpXG5cbiAgcmV0dXJuIGNhbmNlbFxufVxuXG5mdW5jdGlvbiBpbk91dFNpbmUgKG4pIHtcbiAgcmV0dXJuIC41ICogKDEgLSBNYXRoLmNvcyhNYXRoLlBJICogbikpXG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICB0b3A6IGZ1bmN0aW9uIChlbGVtZW50LCB0bywgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gc2Nyb2xsKCdzY3JvbGxUb3AnLCBlbGVtZW50LCB0bywgb3B0aW9ucywgY2FsbGJhY2spXG4gIH0sXG4gIGxlZnQ6IGZ1bmN0aW9uIChlbGVtZW50LCB0bywgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gc2Nyb2xsKCdzY3JvbGxMZWZ0JywgZWxlbWVudCwgdG8sIG9wdGlvbnMsIGNhbGxiYWNrKVxuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCAodXJpKSA9PiB7XG4gIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpXG4gIGxldCBlcnJvckhhbmRsZXIgPSAoKSA9PiB7fVxuXG4gIHhoci5vcGVuKCdHRVQnLCB1cmksIHRydWUpXG5cbiAgcmV0dXJuIHtcbiAgICB0aGVuOiAoY2IpID0+IHtcbiAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgbGV0IHZhbGlkUmVzcG9uc2UgPSB0aGlzLnN0YXR1cyA8IDIwMCB8fCB0aGlzLnN0YXR1cyA+PSA0MDBcbiAgICAgICAgaWYgKHZhbGlkUmVzcG9uc2UgJiYgZXJyb3JIYW5kbGVyKSBlcnJvckhhbmRsZXIodGhpcylcbiAgICAgICAgY2IodGhpcy5yZXNwb25zZSlcbiAgICAgIH1cblxuICAgICAgeGhyLm9uZXJyb3IgPSBlcnJvckhhbmRsZXJcbiAgICAgIHhoci5zZW5kKClcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2F0Y2g6IChoYW5kbGVyKSA9PiB7IGVycm9ySGFuZGxlciA9IGhhbmRsZXIgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIiwiaW1wb3J0IGZldGNoIGZyb20gJy4vZmV0Y2gnXG5cbmZldGNoKCcvYXNzZXRzL2ljb25zL3Nwcml0ZS5zdmcnKVxuICAudGhlbihzcHJpdGUgPT4ge1xuICAgIGxldCBmaWd1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWd1cmUnKVxuICAgIGZpZ3VyZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXG4gICAgZmlndXJlLmlubmVySFRNTCA9IHNwcml0ZVxuICAgIGRvY3VtZW50LmJvZHkuaW5zZXJ0QmVmb3JlKGZpZ3VyZSwgZG9jdW1lbnQuYm9keS5jaGlsZHJlblswXSlcbiAgfSlcbiAgLmNhdGNoKGVyciA9PiB7XG4gICAgY29uc29sZS53YXJuKCdJY29uIHNwcml0ZXNoZWV0IGNvdWxkIG5vdCBiZSBsb2FkZWRcXG4nLCBlcnIpXG4gIH0pXG4iLCIvLyBQcm9kdWN0aW9uIHN0ZXBzIG9mIEVDTUEtMjYyLCBFZGl0aW9uIDYsIDIyLjEuMi4xXG4vLyBSZWZlcmVuY2U6IGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi82LjAvI3NlYy1hcnJheS5mcm9tXG5tb2R1bGUuZXhwb3J0cyA9IChmdW5jdGlvbigpIHtcbiAgdmFyIGlzQ2FsbGFibGUgPSBmdW5jdGlvbihmbikge1xuICAgIHJldHVybiB0eXBlb2YgZm4gPT09ICdmdW5jdGlvbic7XG4gIH07XG4gIHZhciB0b0ludGVnZXIgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB2YXIgbnVtYmVyID0gTnVtYmVyKHZhbHVlKTtcbiAgICBpZiAoaXNOYU4obnVtYmVyKSkgeyByZXR1cm4gMDsgfVxuICAgIGlmIChudW1iZXIgPT09IDAgfHwgIWlzRmluaXRlKG51bWJlcikpIHsgcmV0dXJuIG51bWJlcjsgfVxuICAgIHJldHVybiAobnVtYmVyID4gMCA/IDEgOiAtMSkgKiBNYXRoLmZsb29yKE1hdGguYWJzKG51bWJlcikpO1xuICB9O1xuICB2YXIgbWF4U2FmZUludGVnZXIgPSBNYXRoLnBvdygyLCA1MykgLSAxO1xuICB2YXIgdG9MZW5ndGggPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB2YXIgbGVuID0gdG9JbnRlZ2VyKHZhbHVlKTtcbiAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgobGVuLCAwKSwgbWF4U2FmZUludGVnZXIpO1xuICB9O1xuICB2YXIgaXRlcmF0b3JQcm9wID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICBpZih2YWx1ZSAhPSBudWxsKSB7XG4gICAgICBpZihbJ3N0cmluZycsJ251bWJlcicsJ2Jvb2xlYW4nLCdzeW1ib2wnXS5pbmRleE9mKHR5cGVvZiB2YWx1ZSkgPiAtMSl7XG4gICAgICAgIHJldHVybiBTeW1ib2wuaXRlcmF0b3I7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcpICYmXG4gICAgICAgICgnaXRlcmF0b3InIGluIFN5bWJvbCkgJiZcbiAgICAgICAgKFN5bWJvbC5pdGVyYXRvciBpbiB2YWx1ZSlcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gU3ltYm9sLml0ZXJhdG9yO1xuICAgICAgfVxuICAgICAgLy8gU3VwcG9ydCBcIkBAaXRlcmF0b3JcIiBwbGFjZWhvbGRlciwgR2Vja28gMjcgdG8gR2Vja28gMzVcbiAgICAgIGVsc2UgaWYgKCdAQGl0ZXJhdG9yJyBpbiB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gJ0BAaXRlcmF0b3InO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgdmFyIGdldE1ldGhvZCA9IGZ1bmN0aW9uKE8sIFApIHtcbiAgICAvLyBBc3NlcnQ6IElzUHJvcGVydHlLZXkoUCkgaXMgdHJ1ZS5cbiAgICBpZiAoTyAhPSBudWxsICYmIFAgIT0gbnVsbCkge1xuICAgICAgLy8gTGV0IGZ1bmMgYmUgR2V0VihPLCBQKS5cbiAgICAgIHZhciBmdW5jID0gT1tQXTtcbiAgICAgIC8vIFJldHVybklmQWJydXB0KGZ1bmMpLlxuICAgICAgLy8gSWYgZnVuYyBpcyBlaXRoZXIgdW5kZWZpbmVkIG9yIG51bGwsIHJldHVybiB1bmRlZmluZWQuXG4gICAgICBpZihmdW5jID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgIH1cbiAgICAgIC8vIElmIElzQ2FsbGFibGUoZnVuYykgaXMgZmFsc2UsIHRocm93IGEgVHlwZUVycm9yIGV4Y2VwdGlvbi5cbiAgICAgIGlmICghaXNDYWxsYWJsZShmdW5jKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGZ1bmMgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZnVuYztcbiAgICB9XG4gIH07XG4gIHZhciBpdGVyYXRvclN0ZXAgPSBmdW5jdGlvbihpdGVyYXRvcikge1xuICAgIC8vIExldCByZXN1bHQgYmUgSXRlcmF0b3JOZXh0KGl0ZXJhdG9yKS5cbiAgICAvLyBSZXR1cm5JZkFicnVwdChyZXN1bHQpLlxuICAgIHZhciByZXN1bHQgPSBpdGVyYXRvci5uZXh0KCk7XG4gICAgLy8gTGV0IGRvbmUgYmUgSXRlcmF0b3JDb21wbGV0ZShyZXN1bHQpLlxuICAgIC8vIFJldHVybklmQWJydXB0KGRvbmUpLlxuICAgIHZhciBkb25lID0gQm9vbGVhbihyZXN1bHQuZG9uZSk7XG4gICAgLy8gSWYgZG9uZSBpcyB0cnVlLCByZXR1cm4gZmFsc2UuXG4gICAgaWYoZG9uZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBSZXR1cm4gcmVzdWx0LlxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLy8gVGhlIGxlbmd0aCBwcm9wZXJ0eSBvZiB0aGUgZnJvbSBtZXRob2QgaXMgMS5cbiAgcmV0dXJuIGZ1bmN0aW9uIGZyb20oaXRlbXMgLyosIG1hcEZuLCB0aGlzQXJnICovICkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8vIDEuIExldCBDIGJlIHRoZSB0aGlzIHZhbHVlLlxuICAgIHZhciBDID0gdGhpcztcblxuICAgIC8vIDIuIElmIG1hcGZuIGlzIHVuZGVmaW5lZCwgbGV0IG1hcHBpbmcgYmUgZmFsc2UuXG4gICAgdmFyIG1hcEZuID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB2b2lkIDA7XG5cbiAgICB2YXIgVDtcbiAgICBpZiAodHlwZW9mIG1hcEZuICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgLy8gMy4gZWxzZVxuICAgICAgLy8gICBhLiBJZiBJc0NhbGxhYmxlKG1hcGZuKSBpcyBmYWxzZSwgdGhyb3cgYSBUeXBlRXJyb3IgZXhjZXB0aW9uLlxuICAgICAgaWYgKCFpc0NhbGxhYmxlKG1hcEZuKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgICdBcnJheS5mcm9tOiB3aGVuIHByb3ZpZGVkLCB0aGUgc2Vjb25kIGFyZ3VtZW50IG11c3QgYmUgYSBmdW5jdGlvbidcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gICBiLiBJZiB0aGlzQXJnIHdhcyBzdXBwbGllZCwgbGV0IFQgYmUgdGhpc0FyZzsgZWxzZSBsZXQgVFxuICAgICAgLy8gICAgICBiZSB1bmRlZmluZWQuXG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgVCA9IGFyZ3VtZW50c1syXTtcbiAgICAgIH1cbiAgICAgIC8vICAgYy4gTGV0IG1hcHBpbmcgYmUgdHJ1ZSAoaW1wbGllZCBieSBtYXBGbilcbiAgICB9XG5cbiAgICB2YXIgQSwgaztcblxuICAgIC8vIDQuIExldCB1c2luZ0l0ZXJhdG9yIGJlIEdldE1ldGhvZChpdGVtcywgQEBpdGVyYXRvcikuXG4gICAgLy8gNS4gUmV0dXJuSWZBYnJ1cHQodXNpbmdJdGVyYXRvcikuXG4gICAgdmFyIHVzaW5nSXRlcmF0b3IgPSBnZXRNZXRob2QoaXRlbXMsIGl0ZXJhdG9yUHJvcChpdGVtcykpO1xuXG4gICAgLy8gNi4gSWYgdXNpbmdJdGVyYXRvciBpcyBub3QgdW5kZWZpbmVkLCB0aGVuXG4gICAgaWYgKHVzaW5nSXRlcmF0b3IgIT09IHZvaWQgMCkge1xuICAgICAgLy8gYS4gSWYgSXNDb25zdHJ1Y3RvcihDKSBpcyB0cnVlLCB0aGVuXG4gICAgICAvLyAgIGkuIExldCBBIGJlIHRoZSByZXN1bHQgb2YgY2FsbGluZyB0aGUgW1tDb25zdHJ1Y3RdXVxuICAgICAgLy8gICAgICBpbnRlcm5hbCBtZXRob2Qgb2YgQyB3aXRoIGFuIGVtcHR5IGFyZ3VtZW50IGxpc3QuXG4gICAgICAvLyBiLiBFbHNlLFxuICAgICAgLy8gICBpLiBMZXQgQSBiZSB0aGUgcmVzdWx0IG9mIHRoZSBhYnN0cmFjdCBvcGVyYXRpb24gQXJyYXlDcmVhdGVcbiAgICAgIC8vICAgICAgd2l0aCBhcmd1bWVudCAwLlxuICAgICAgLy8gYy4gUmV0dXJuSWZBYnJ1cHQoQSkuXG4gICAgICBBID0gaXNDYWxsYWJsZShDKSA/IE9iamVjdChuZXcgQygpKSA6IFtdO1xuXG4gICAgICAvLyBkLiBMZXQgaXRlcmF0b3IgYmUgR2V0SXRlcmF0b3IoaXRlbXMsIHVzaW5nSXRlcmF0b3IpLlxuICAgICAgdmFyIGl0ZXJhdG9yID0gdXNpbmdJdGVyYXRvci5jYWxsKGl0ZW1zKTtcblxuICAgICAgLy8gZS4gUmV0dXJuSWZBYnJ1cHQoaXRlcmF0b3IpLlxuICAgICAgaWYgKGl0ZXJhdG9yID09IG51bGwpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcbiAgICAgICAgICAnQXJyYXkuZnJvbSByZXF1aXJlcyBhbiBhcnJheS1saWtlIG9yIGl0ZXJhYmxlIG9iamVjdCdcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gZi4gTGV0IGsgYmUgMC5cbiAgICAgIGsgPSAwO1xuXG4gICAgICAvLyBnLiBSZXBlYXRcbiAgICAgIHZhciBuZXh0LCBuZXh0VmFsdWU7XG4gICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAvLyBpLiBMZXQgUGsgYmUgVG9TdHJpbmcoaykuXG4gICAgICAgIC8vIGlpLiBMZXQgbmV4dCBiZSBJdGVyYXRvclN0ZXAoaXRlcmF0b3IpLlxuICAgICAgICAvLyBpaWkuIFJldHVybklmQWJydXB0KG5leHQpLlxuICAgICAgICBuZXh0ID0gaXRlcmF0b3JTdGVwKGl0ZXJhdG9yKTtcblxuICAgICAgICAvLyBpdi4gSWYgbmV4dCBpcyBmYWxzZSwgdGhlblxuICAgICAgICBpZiAoIW5leHQpIHtcblxuICAgICAgICAgIC8vIDEuIExldCBzZXRTdGF0dXMgYmUgU2V0KEEsIFwibGVuZ3RoXCIsIGssIHRydWUpLlxuICAgICAgICAgIC8vIDIuIFJldHVybklmQWJydXB0KHNldFN0YXR1cykuXG4gICAgICAgICAgQS5sZW5ndGggPSBrO1xuXG4gICAgICAgICAgLy8gMy4gUmV0dXJuIEEuXG4gICAgICAgICAgcmV0dXJuIEE7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdi4gTGV0IG5leHRWYWx1ZSBiZSBJdGVyYXRvclZhbHVlKG5leHQpLlxuICAgICAgICAvLyB2aS4gUmV0dXJuSWZBYnJ1cHQobmV4dFZhbHVlKVxuICAgICAgICBuZXh0VmFsdWUgPSBuZXh0LnZhbHVlO1xuXG4gICAgICAgIC8vIHZpaS4gSWYgbWFwcGluZyBpcyB0cnVlLCB0aGVuXG4gICAgICAgIC8vICAgMS4gTGV0IG1hcHBlZFZhbHVlIGJlIENhbGwobWFwZm4sIFQsIMKrbmV4dFZhbHVlLCBrwrspLlxuICAgICAgICAvLyAgIDIuIElmIG1hcHBlZFZhbHVlIGlzIGFuIGFicnVwdCBjb21wbGV0aW9uLCByZXR1cm5cbiAgICAgICAgLy8gICAgICBJdGVyYXRvckNsb3NlKGl0ZXJhdG9yLCBtYXBwZWRWYWx1ZSkuXG4gICAgICAgIC8vICAgMy4gTGV0IG1hcHBlZFZhbHVlIGJlIG1hcHBlZFZhbHVlLltbdmFsdWVdXS5cbiAgICAgICAgLy8gdmlpaS4gRWxzZSwgbGV0IG1hcHBlZFZhbHVlIGJlIG5leHRWYWx1ZS5cbiAgICAgICAgLy8gaXguICBMZXQgZGVmaW5lU3RhdHVzIGJlIHRoZSByZXN1bHQgb2ZcbiAgICAgICAgLy8gICAgICBDcmVhdGVEYXRhUHJvcGVydHlPclRocm93KEEsIFBrLCBtYXBwZWRWYWx1ZSkuXG4gICAgICAgIC8vIHguIFtUT0RPXSBJZiBkZWZpbmVTdGF0dXMgaXMgYW4gYWJydXB0IGNvbXBsZXRpb24sIHJldHVyblxuICAgICAgICAvLyAgICBJdGVyYXRvckNsb3NlKGl0ZXJhdG9yLCBkZWZpbmVTdGF0dXMpLlxuICAgICAgICBpZiAobWFwRm4pIHtcbiAgICAgICAgICBBW2tdID0gbWFwRm4uY2FsbChULCBuZXh0VmFsdWUsIGspO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIEFba10gPSBuZXh0VmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8geGkuIEluY3JlYXNlIGsgYnkgMS5cbiAgICAgICAgaysrO1xuICAgICAgfVxuICAgICAgLy8gNy4gQXNzZXJ0OiBpdGVtcyBpcyBub3QgYW4gSXRlcmFibGUgc28gYXNzdW1lIGl0IGlzXG4gICAgICAvLyAgICBhbiBhcnJheS1saWtlIG9iamVjdC5cbiAgICB9IGVsc2Uge1xuXG4gICAgICAvLyA4LiBMZXQgYXJyYXlMaWtlIGJlIFRvT2JqZWN0KGl0ZW1zKS5cbiAgICAgIHZhciBhcnJheUxpa2UgPSBPYmplY3QoaXRlbXMpO1xuXG4gICAgICAvLyA5LiBSZXR1cm5JZkFicnVwdChpdGVtcykuXG4gICAgICBpZiAoaXRlbXMgPT0gbnVsbCkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgICdBcnJheS5mcm9tIHJlcXVpcmVzIGFuIGFycmF5LWxpa2Ugb2JqZWN0IC0gbm90IG51bGwgb3IgdW5kZWZpbmVkJ1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyAxMC4gTGV0IGxlbiBiZSBUb0xlbmd0aChHZXQoYXJyYXlMaWtlLCBcImxlbmd0aFwiKSkuXG4gICAgICAvLyAxMS4gUmV0dXJuSWZBYnJ1cHQobGVuKS5cbiAgICAgIHZhciBsZW4gPSB0b0xlbmd0aChhcnJheUxpa2UubGVuZ3RoKTtcblxuICAgICAgLy8gMTIuIElmIElzQ29uc3RydWN0b3IoQykgaXMgdHJ1ZSwgdGhlblxuICAgICAgLy8gICAgIGEuIExldCBBIGJlIENvbnN0cnVjdChDLCDCq2xlbsK7KS5cbiAgICAgIC8vIDEzLiBFbHNlXG4gICAgICAvLyAgICAgYS4gTGV0IEEgYmUgQXJyYXlDcmVhdGUobGVuKS5cbiAgICAgIC8vIDE0LiBSZXR1cm5JZkFicnVwdChBKS5cbiAgICAgIEEgPSBpc0NhbGxhYmxlKEMpID8gT2JqZWN0KG5ldyBDKGxlbikpIDogbmV3IEFycmF5KGxlbik7XG5cbiAgICAgIC8vIDE1LiBMZXQgayBiZSAwLlxuICAgICAgayA9IDA7XG4gICAgICAvLyAxNi4gUmVwZWF0LCB3aGlsZSBrIDwgbGVu4oCmIChhbHNvIHN0ZXBzIGEgLSBoKVxuICAgICAgdmFyIGtWYWx1ZTtcbiAgICAgIHdoaWxlIChrIDwgbGVuKSB7XG4gICAgICAgIGtWYWx1ZSA9IGFycmF5TGlrZVtrXTtcbiAgICAgICAgaWYgKG1hcEZuKSB7XG4gICAgICAgICAgQVtrXSA9IG1hcEZuLmNhbGwoVCwga1ZhbHVlLCBrKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBBW2tdID0ga1ZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGsrKztcbiAgICAgIH1cbiAgICAgIC8vIDE3LiBMZXQgc2V0U3RhdHVzIGJlIFNldChBLCBcImxlbmd0aFwiLCBsZW4sIHRydWUpLlxuICAgICAgLy8gMTguIFJldHVybklmQWJydXB0KHNldFN0YXR1cykuXG4gICAgICBBLmxlbmd0aCA9IGxlbjtcbiAgICAgIC8vIDE5LiBSZXR1cm4gQS5cbiAgICB9XG4gICAgcmV0dXJuIEE7XG4gIH07XG59KSgpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSAodHlwZW9mIEFycmF5LmZyb20gPT09ICdmdW5jdGlvbicgP1xuICBBcnJheS5mcm9tIDpcbiAgcmVxdWlyZSgnLi9wb2x5ZmlsbCcpXG4pO1xuIiwiaW1wb3J0IGFycmF5RnJvbSBmcm9tICdhcnJheS1mcm9tJ1xuXG5jb25zdCBzY3JvbGxCb3ggPSBkb2N1bWVudC5zY3JvbGxpbmdFbGVtZW50IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudFxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIHNjcm9sbEJveCxcblxuICBmaW5kOiAocXVlcnksIHNjb3BlID0gZG9jdW1lbnQpID0+XG4gICAgc2NvcGUucXVlcnlTZWxlY3RvcihxdWVyeSksXG5cbiAgZmluZEFsbDogKHF1ZXJ5LCBzY29wZSA9IGRvY3VtZW50KSA9PlxuICAgIGFycmF5RnJvbShzY29wZS5xdWVyeVNlbGVjdG9yQWxsKHF1ZXJ5KSksXG5cbiAgZ2V0IHNjcm9sbFRvcCgpIHtcbiAgICByZXR1cm4gc2Nyb2xsQm94LnNjcm9sbFRvcFxuICB9XG59XG4iLCJpbXBvcnQgZG9tIGZyb20gJy4vZG9tLWhlbHBlcnMnXG5cbmNvbnN0IHRpbWVyID0gZG9tLmZpbmQoJ1tkYXRhLXRpbWVyXScpXG5sZXQgaW5kZXggPSAwXG5cbmNvbnN0IHNsaWRlcyA9IGRvbS5maW5kQWxsKCdbZGF0YS1zbGlkZV0nKVxuICAubWFwKChub2RlLCBpKSA9PiB7XG4gICAgaWYgKCFpKSBub2RlLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZS1zbGlkZScpXG4gICAgZWxzZSBub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZS1zbGlkZScpXG4gICAgcmV0dXJuIG5vZGVcbiAgfSlcblxuY29uc3Qgc3dhcFNsaWRlcyA9ICgpID0+IHtcbiAgc2xpZGVzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUtc2xpZGUnKVxuICBpbmRleCA9IChpbmRleCArIDEgPT09IHNsaWRlcy5sZW5ndGgpID8gMCA6IGluZGV4ICsgMVxuICBzbGlkZXNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZS1zbGlkZScpXG4gIHRpbWVyLmNsYXNzTGlzdC5hZGQoJ3J1bm5pbmcnKVxufVxuXG50aW1lci5hZGRFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uZW5kJywgKCkgPT4ge1xuICB0aW1lci5jbGFzc0xpc3QucmVtb3ZlKCdydW5uaW5nJylcbiAgc2V0VGltZW91dChzd2FwU2xpZGVzLCAxMjUpXG59KVxuXG5zZXRUaW1lb3V0KCgpID0+IHtcbiAgdGltZXIuY2xhc3NMaXN0LmFkZCgncnVubmluZycpXG59LCAyNTApXG4iLCJ2YXIgd2luO1xuXG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHdpbiA9IHdpbmRvdztcbn0gZWxzZSBpZiAodHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHdpbiA9IGdsb2JhbDtcbn0gZWxzZSBpZiAodHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIpe1xuICAgIHdpbiA9IHNlbGY7XG59IGVsc2Uge1xuICAgIHdpbiA9IHt9O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHdpbjtcbiIsInZhciBnbG9iYWwgPSByZXF1aXJlKCdnbG9iYWwnKVxuXG4vKipcbiAqIGByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKWBcbiAqL1xuXG52YXIgcmVxdWVzdCA9IGdsb2JhbC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgfHwgZ2xvYmFsLndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZVxuICB8fCBnbG9iYWwubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lXG4gIHx8IGZhbGxiYWNrXG5cbnZhciBwcmV2ID0gK25ldyBEYXRlXG5mdW5jdGlvbiBmYWxsYmFjayAoZm4pIHtcbiAgdmFyIGN1cnIgPSArbmV3IERhdGVcbiAgdmFyIG1zID0gTWF0aC5tYXgoMCwgMTYgLSAoY3VyciAtIHByZXYpKVxuICB2YXIgcmVxID0gc2V0VGltZW91dChmbiwgbXMpXG4gIHJldHVybiBwcmV2ID0gY3VyciwgcmVxXG59XG5cbi8qKlxuICogYGNhbmNlbEFuaW1hdGlvbkZyYW1lKClgXG4gKi9cblxudmFyIGNhbmNlbCA9IGdsb2JhbC5jYW5jZWxBbmltYXRpb25GcmFtZVxuICB8fCBnbG9iYWwud2Via2l0Q2FuY2VsQW5pbWF0aW9uRnJhbWVcbiAgfHwgZ2xvYmFsLm1vekNhbmNlbEFuaW1hdGlvbkZyYW1lXG4gIHx8IGNsZWFyVGltZW91dFxuXG5pZiAoRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQpIHtcbiAgcmVxdWVzdCA9IHJlcXVlc3QuYmluZChnbG9iYWwpXG4gIGNhbmNlbCA9IGNhbmNlbC5iaW5kKGdsb2JhbClcbn1cblxuZXhwb3J0cyA9IG1vZHVsZS5leHBvcnRzID0gcmVxdWVzdFxuZXhwb3J0cy5jYW5jZWwgPSBjYW5jZWxcbiIsImltcG9ydCBzY3JvbGwgZnJvbSAnc2Nyb2xsJ1xuaW1wb3J0IGRvbSBmcm9tICcuL2RvbS1oZWxwZXJzJ1xuXG5jb25zdCBuYXZIZWlnaHQgPSAoKSA9PlxuICBkb20uZmluZCgnW2RhdGEtaGVhZGVyXScpLmNsaWVudEhlaWdodFxuXG5jb25zdCByZXNvbHZlVGFyZ2V0ID0gKGlkKSA9PlxuICBkb20uc2Nyb2xsVG9wICsgZG9tLmZpbmQoaWQpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAtIG5hdkhlaWdodCgpXG5cbmNvbnN0IHNjcm9sbEhhbmRsZXIgPSBmdW5jdGlvbihlKSB7XG4gIGUucHJldmVudERlZmF1bHQoKVxuICBzY3JvbGwudG9wKGRvbS5zY3JvbGxCb3gsIHJlc29sdmVUYXJnZXQodGhpcy5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSksIHsgZHVyYXRpb246IDUwMCB9KVxufVxuXG5kb20uZmluZEFsbCgnW2RhdGEtc2Nyb2xsLXRvXScpXG4gIC5mb3JFYWNoKG5vZGUgPT4ge1xuICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzY3JvbGxIYW5kbGVyKVxuICB9KVxuIiwiaW1wb3J0IGRvbSBmcm9tICcuL2RvbS1oZWxwZXJzJ1xuXG5jb25zdCBoZWFkZXIgPSBkb20uZmluZCgnW2RhdGEtaGVhZGVyXScpXG5sZXQgc2Nyb2xsLCBidWZmZXIsIGRvY2tlZFxuXG5jb25zdCB1cGRhdGUgPSAoKSA9PiB7XG4gIGxldCBkb2NrID0gc2Nyb2xsID4gMTAgJiYgIWRvY2tlZFxuICBsZXQgdW5kb2NrID0gc2Nyb2xsIDw9IDEwICYmIGRvY2tlZFxuXG4gIGlmIChkb2NrIHx8IHVuZG9jaykgZG9ja2VkID0gaGVhZGVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci0tZG9ja2VkJylcbiAgYnVmZmVyID0gZmFsc2Vcbn1cblxuY29uc3QgcmVxdWVzdFVwZGF0ZSA9ICgpID0+IHtcbiAgaWYgKCFidWZmZXIpIHJlcXVlc3RBbmltYXRpb25GcmFtZSh1cGRhdGUpXG4gIGJ1ZmZlciA9IHRydWVcbiAgc2Nyb2xsID0gZG9tLnNjcm9sbFRvcFxufVxuXG5yZXF1ZXN0VXBkYXRlKClcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCByZXF1ZXN0VXBkYXRlKVxuIiwiaW1wb3J0IGRvbSBmcm9tICcuL2RvbS1oZWxwZXJzJ1xuXG5jb25zdCBnZXRGbGlwSGFuZGxlciA9IChub2RlKSA9PlxuICAoKSA9PiBub2RlLmNsYXNzTGlzdC5hZGQoJ2NhcmQtLWZsaXAnKVxuXG5jb25zdCBnZXRVbmZsaXBIYW5kbGVyID0gKG5vZGUpID0+XG4gICgpID0+IG5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2FyZC0tZmxpcCcpXG5cbmNvbnN0IGdldFNob3J0ZXN0U2lkZSA9IChbZnJvbnQsIGJhY2tdKSA9PlxuICAoZnJvbnQuY2xpZW50SGVpZ2h0IDwgYmFjay5jbGllbnRIZWlnaHQpID8gZnJvbnQgOiBiYWNrXG5cbmRvbS5maW5kQWxsKCdbZGF0YS1jYXJkXScpXG4gIC5mb3JFYWNoKG5vZGUgPT4ge1xuICAgIGdldFNob3J0ZXN0U2lkZShub2RlLmNoaWxkcmVuKVxuICAgICAgLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJ1xuXG4gICAgZG9tLmZpbmRBbGwoJ1tkYXRhLWNhcmQtZmxpcF0nLCBub2RlKVxuICAgICAgLmZvckVhY2goZmxpcE5vZGUgPT4ge1xuICAgICAgICBmbGlwTm9kZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGdldEZsaXBIYW5kbGVyKG5vZGUpKVxuICAgICAgfSlcblxuICAgIGRvbS5maW5kQWxsKCdbZGF0YS1jYXJkLXVuZmxpcF0nLCBub2RlKVxuICAgICAgLmZvckVhY2godW5mbGlwTm9kZSA9PiB7XG4gICAgICAgIHVuZmxpcE5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBnZXRVbmZsaXBIYW5kbGVyKG5vZGUpKVxuICAgICAgfSlcbiAgfSlcbiIsImltcG9ydCBmZXRjaCBmcm9tICcuL2ZldGNoJ1xuXG5jb25zdCBtYXBOb2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpXG5cbmNvbnN0IGdldFNjcmlwdFRhZyA9IChrZXkpID0+IHtcbiAgbGV0IHRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpXG4gIHRhZy5zZXRBdHRyaWJ1dGUoJ2FzeW5jJywgJycpXG4gIHRhZy5zZXRBdHRyaWJ1dGUoJ2RlZmVyJywgJycpXG4gIHRhZy5zZXRBdHRyaWJ1dGUoJ3NyYycsIGBodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/a2V5PSR7a2V5fSZjYWxsYmFjaz1pbml0TWFwYClcbiAgcmV0dXJuIHRhZ1xufVxuXG5pZiAobWFwTm9kZSkge1xuICBmZXRjaCgnL2Fzc2V0cy9kYXRhL21hcC1jb25maWcuanNvbicpXG4gICAgLnRoZW4oY29uZmlnID0+IHtcbiAgICAgIGxldCB7IGtleSwgb3B0aW9ucywgbWFya2VyOiBwb3NpdGlvbiB9ID0gSlNPTi5wYXJzZShjb25maWcpXG5cbiAgICAgIGNvbnN0IGluaXQgPSB7XG4gICAgICAgIG1hcDogKCkgPT4gbmV3IGdvb2dsZS5tYXBzLk1hcChtYXBOb2RlLCBvcHRpb25zKSxcbiAgICAgICAgbWFya2VyOiAobWFwKSA9PiBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgICBwb3NpdGlvbixcbiAgICAgICAgICBtYXAsXG4gICAgICAgICAgaWNvbjogJy9hc3NldHMvbWVkaWEvbG9nby9sbGItbWFwLnBuZydcbiAgICAgICAgfSlcbiAgICAgIH1cblxuICAgICAgd2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gICAgICAgIGluaXQubWFya2VyKGluaXQubWFwKCkpXG4gICAgICB9XG5cbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZ2V0U2NyaXB0VGFnKGtleSkpXG4gICAgfSlcbiAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpXG59XG4iLCJpbXBvcnQgZG9tIGZyb20gJy4vZG9tLWhlbHBlcnMnXG5cbmNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpXG5cbmRvbS5maW5kQWxsKCd0aW1lW2RhdGEteWVhcl0nKVxuICAuZm9yRWFjaChub2RlID0+IHtcbiAgICBub2RlLmlubmVySFRNTCArPSBkYXRlLmdldEZ1bGxZZWFyKClcbiAgfSlcbiIsImltcG9ydCBkb20gZnJvbSAnLi9kb20taGVscGVycydcblxuY29uc3QgaGVhZGVyID0gZG9tLmZpbmQoJ1tkYXRhLWhlYWRlcl0nKVxuXG5kb20uZmluZCgnW2RhdGEtYnVyZ2VyXScsIGhlYWRlcilcbiAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGhlYWRlci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItLW9wZW4nKVxuICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnbm9zY3JvbGwnKVxuICB9KVxuXG5kb20uZmluZEFsbCgnW2RhdGEtc2Nyb2xsLXRvXScpXG4gIC5mb3JFYWNoKG5vZGUgPT4ge1xuICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBoZWFkZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGVhZGVyLS1vcGVuJylcbiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbm9zY3JvbGwnKVxuICAgIH0pXG4gIH0pXG4iLCJpbXBvcnQgZG9tIGZyb20gJy4vZG9tLWhlbHBlcnMnXG5cbnZvaWQgKChmb3JtKSA9PiB7XG4gIGlmICghZm9ybSkgcmV0dXJuO1xuXG4gIGRvbS5maW5kQWxsKCdpbnB1dCwgdGV4dGFyZWEnLCBmb3JtKVxuICAgIC5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgKCkgPT4ge1xuICAgICAgICBpbnB1dC5kYXRhc2V0LnN0YXRlID0gJ29rJ1xuICAgICAgfSlcbiAgICB9KVxuXG4gIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcblxuICAgIGNvbnN0IGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKVxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKClcblxuICAgIGxldCB2YWxpZCA9IHRydWVcbiAgICBsZXQgc3VibWl0dGVkID0gZmFsc2VcbiAgICBsZXQgZmlsZUlucHV0ID0gZG9tLmZpbmQoJ1tkYXRhLWF0dGFjaG1lbnRdJywgZm9ybSlcblxuICAgIGxldCBmaWVsZHMgPSB7XG4gICAgICBuYW1lOiBkb20uZmluZCgnW25hbWU9XCJuYW1lXCJdJywgZm9ybSksXG4gICAgICBzdXJuYW1lOiBkb20uZmluZCgnW25hbWU9XCJzdXJuYW1lXCJdJywgZm9ybSksXG4gICAgICBlbWFpbDogZG9tLmZpbmQoJ1tuYW1lPVwiZW1haWxcIl0nLCBmb3JtKSxcbiAgICAgIG1lc3NhZ2U6IGRvbS5maW5kKCdbbmFtZT1cIm1lc3NhZ2VcIl0nLCBmb3JtKVxuICAgIH1cblxuICAgIE9iamVjdC52YWx1ZXMoZmllbGRzKVxuICAgICAgLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgICBpZiAoIWZpZWxkLnZhbHVlIHx8ICFmaWVsZC52YWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgICBmaWVsZC5kYXRhc2V0LnN0YXRlID0gJ2Vycm9yJ1xuICAgICAgICAgIHZhbGlkID0gZmFsc2VcbiAgICAgICAgfSBlbHNlIGlmIChmaWVsZC5uYW1lID09PSAnZW1haWwnICYmICEvLitALitcXC4uKy8udGVzdChmaWVsZC52YWx1ZSkpIHtcbiAgICAgICAgICBmaWVsZC5kYXRhc2V0LnN0YXRlID0gJ2Vycm9yJ1xuICAgICAgICAgIHZhbGlkID0gZmFsc2VcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgIGlmIChzdWJtaXR0ZWQgfHwgIXZhbGlkKSByZXR1cm47XG4gICAgc3VibWl0dGVkID0gdHJ1ZVxuXG4gICAgaHR0cC5vcGVuKCdQT1NUJywgJ2h0dHA6Ly91ZHkuaW8vYXBpL21haWwvJywgdHJ1ZSlcblxuICAgIGZvcm0uZGF0YXNldC5zdGF0ZSA9ICdzZW5kaW5nJ1xuICAgIGZvcm1EYXRhLmFwcGVuZCgnc2l0ZW5hbWUnLCAnbGxiLWNwYScpXG4gICAgZm9ybURhdGEuYXBwZW5kKCdlbWFpbCcsIGZpZWxkcy5lbWFpbC52YWx1ZSlcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ21haWx0bycsICdyZWNlcHRpb25AbGxiY3BhLmNhJylcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ21lc3NhZ2UnLCBmaWVsZHMubWVzc2FnZS52YWx1ZSlcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ3N1YmplY3QnLCAnTm91dmVhdSBjb250YWN0JylcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ25hbWUnLCBgJHtmaWVsZHMubmFtZS52YWx1ZX0gJHtmaWVsZHMuc3VybmFtZS52YWx1ZX1gKVxuXG4gICAgaWYgKGZpbGVJbnB1dCkgZm9ybURhdGEuYXBwZW5kKCdhdHRhY2htZW50JywgZmlsZUlucHV0LmZpbGVzWzBdKVxuXG4gICAgaHR0cC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5zdGF0dXMgPj0gMjAwICYmIHRoaXMuc3RhdHVzIDwgNDAwKSB7XG4gICAgICAgIGZvcm0uZGF0YXNldC5zdGF0ZSA9ICdzdWNjZXNzJ1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9ybS5kYXRhc2V0LnN0YXRlID0gJ2Vycm9yJ1xuICAgICAgfVxuICAgIH0pXG5cbiAgICBodHRwLnNlbmQoZm9ybURhdGEpXG4gIH0pXG59KShkb20uZmluZCgnW2RhdGEtY29udGFjdC1mb3JtXScpKVxuIl19
